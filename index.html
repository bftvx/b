<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Video Library</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: #fff;
}

/* LAYOUT */
.container {
  display: flex;
}

/* SIDEBAR */
.sidebar {
  width: 220px;
  background: #121212;
  padding: 15px;
  border-right: 1px solid #222;
}

.sidebar h3 {
  margin-top: 0;
  font-weight: 500;
}

.category {
  padding: 8px 10px;
  border-radius: 8px;
  cursor: pointer;
  margin-bottom: 6px;
  background: #1c1c1c;
}

.category:hover {
  background: #2a2a2a;
}

.category.active {
  background: #3a3a3a;
}

/* MAIN */
.main {
  flex: 1;
  padding: 20px;
}

.top-bar input {
  padding: 8px;
  background: #181818;
  border: 1px solid #333;
  color: white;
  border-radius: 6px;
  margin-right: 6px;
}

.top-bar button {
  background: #272727;
  border: 1px solid #3a3a3a;
  color: white;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
}

.video-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px,1fr));
  gap: 20px;
  margin-top: 20px;
}

.video-card {
  background: #181818;
  padding: 10px;
  border-radius: 14px;
  transition: transform .2s ease;
}

.video-card:hover {
  transform: translateY(-5px);
}

iframe {
  width: 100%;
  height: 180px;
  border-radius: 12px;
  border: none;
}

.title {
  text-align: center;
  margin-top: 6px;
  font-size: 14px;
}

.actions {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 6px;
}

.actions img {
  width: 22px;
  cursor: pointer;
}

.delete-btn {
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container">

  <!-- üìÇ SIDEBAR -->
  <div class="sidebar">
    <h3>Categories</h3>
    <div id="categories"></div>
    <button onclick="addCategory()">‚ûï Add</button>
  </div>

  <!-- üé¨ MAIN -->
  <div class="main">
    <h2 id="currentCategory">Home</h2>

    <div class="top-bar">
      <input id="videoUrl" placeholder="Paste URL">
      <input id="videoTitle" placeholder="Title">
      <button onclick="addVideo()">‚ûï</button>
    </div>

    <div class="video-grid" id="videoGrid"></div>
  </div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbx0hoCsO6o-Np3DCn5YnbJSXcaHl4kBthNXYa-Q5mxV7vQfy0MCgKQ_4oUD-SooLKns/exec";
const DELETE_PASSWORD = "00000";

let currentCategory = "Home";
let categories = new Set(["Home"]);

function getDomain(url) {
  try { return new URL(url).hostname; }
  catch { return "google.com"; }
}

async function loadVideos() {
  const res = await fetch(API_URL + "?category=" + currentCategory);
  const data = await res.json();
  videoGrid.innerHTML = "";

  data.forEach(([url,title]) => {
    videoGrid.innerHTML += `
      <div class="video-card">
        <iframe src="${url}" allowfullscreen></iframe>
        <div class="title">${title}</div>
        <div class="actions">
          <a href="${url}" target="_blank">
            <img src="https://www.google.com/s2/favicons?domain=${getDomain(url)}&sz=64">
          </a>
          <span class="delete-btn" onclick="deleteVideo('${url}')">üóëÔ∏è</span>
        </div>
      </div>
    `;
  });
}

async function loadCategories() {
  const res = await fetch(API_URL + "?category=ALL");
  const data = await res.json();
  data.forEach(r => categories.add(r[2] || "Home"));

  const container = document.getElementById("categories");
  container.innerHTML = "";

  categories.forEach(c => {
    const div = document.createElement("div");
    div.className = "category" + (c === currentCategory ? " active" : "");
    div.innerText = c;
    div.onclick = () => {
      currentCategory = c;
      document.getElementById("currentCategory").innerText = c;
      loadCategories();
      loadVideos();
    };
    container.appendChild(div);
  });
}

function addCategory() {
  const name = prompt("Category name:");
  if (!name) return;
  categories.add(name);
  loadCategories();
}

async function addVideo() {
  if (!videoUrl.value) return alert("Paste URL");

  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      url: videoUrl.value,
      title: videoTitle.value,
      category: currentCategory
    })
  });

  videoUrl.value = "";
  videoTitle.value = "";
  loadVideos();
}

async function deleteVideo(url) {
  if (prompt("Password") !== DELETE_PASSWORD) return;
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action:"delete", url })
  });
  loadVideos();
}

loadCategories();
loadVideos();
</script>

</body>
</html>
